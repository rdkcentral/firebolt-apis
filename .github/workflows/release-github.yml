name: Release to GitHub
on:
  workflow_dispatch:

jobs:
  release:
    name: Release
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: 'lts/*'
      - name: Install dependencies
        run: npm ci
      - name: Generate SDK
      - run: npm run fs:setup
      - run: npm run build:sdk
      - run: npm run dist:declarations
      - run: npm run dist:sdk
      - name: Validate SDK
      - run: npm run validate:each
      - name: Test SDK
      - run: npm run test
      - name: Generate OpenRpc
        run: npm run build:openrpc
      - name: Generate Docs
        run: npm run build:docs
      - name: Copy docs to dist
        run: npm run dist:docs
      - name: Generate TypeScript Declarations
        run: npm run dist:declarations
      - name: Release to GitHub
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: npx semantic-release